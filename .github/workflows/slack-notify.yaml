name: Slack Notification

on:
  push:
    branches:
      - set-*

# env:
#   SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Send custom JSON data to Slack workflow
        id: slack
        uses: slackapi/slack-github-action@v1.26.0
        with:
            payload: |
                {
                "blocks": [
                    {
                    "type": "section",
                    "text": {
                        "type": "mrkdwn",
                        "text": "*:white_check_mark: Succeeded GitHub Actions*"
                    }
                    },
                    {
                    "type": "section",
                    "fields": [
                        {
                        "type": "mrkdwn",
                        "text": "*Repo*\n<https://github.com/${{ github.repository }}|${{ github.repository }}>"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Commit*\n<${{ github.event.head_commit.url }}|${{ env.SHORT_SHA }}>"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Author*\n${{ github.event.head_commit.author.name }}"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Job*\n`${{ github.job }}`"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Event Name*\n`${{ github.event_name }}`"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Workflow*\n`${{ github.workflow }}`"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Build Logs*\n<${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Logs>"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Took*\n`${{ steps.calculate_duration.outputs.duration }} sec`"
                        },
                        {
                        "type": "mrkdwn",
                        "text": "*Message*\n${{ github.event.head_commit.message }}"
                        }
                    ]
                    }
                ]
                }
            env:
            SLACK_WEBHOOK_URL: "https://hooks.slack.com/services/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"
            SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
            